<head>
    <title>Code Lyoko VR</title>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="aframe-super-shooter-kit.min.js"></script>
    <script>
        /**
         * Click mouse to shoot.
         */
        AFRAME.registerComponent('click-to-shoot', {
            init: function () {
                document.body.addEventListener('mousedown', () => { this.el.emit('shoot'); });
            }
        });
        /**
         * Change color when hit.
         */
        AFRAME.registerComponent('hit-handler', {
            dependencies: ['material'],
            init: function () {
                var color;
                var el = this.el;
                color = new THREE.Color();
                color.set('#666');
                el.components.material.material.color.copy(color);
                el.addEventListener('hit', () => {
                    color.addScalar(0.05);
                    el.components.material.material.color.copy(color);
                });
                el.addEventListener('die', () => {
                    color.setRGB(1, 0, 0);
                    el.components.material.material.color.copy(color);
                });
            }
        });
        //AFRAME.registerComponent('listener', {
        //    tick: function () {
        //      console.log(this.el.getAttribute('position'));
        //    }
        //  });
    </script>
</head>

<body>
    <a-scene>
        <a-assets>
            <a-asset-item id="map" src="assets/model.dae"></a-asset-item>
            <a-asset-item id="tower" src="assets/tower/scene.gltf"></a-asset-item>
            <a-asset-item id="weapons" src="assets/odd/odd.dae"></a-asset-item>
        </a-assets>

        <a-collada-model src="#map"></a-collada-model>
        <a-gltf-model src="#tower" scale="0.1 0.08 0.1" rotation="0 180 0" position="-40 1 -17.034564105607295"></a-gltf-model>


        <a-entity id="bulletTemplate" bullet geometry="primitive: sphere; radius: 0.1" material="color: orange"></a-entity>

        <a-entity class="target" target="healthPoints: 10" geometry="primitive: box" material="color: teal" position="0 0 -4"
            hit-handler></a-entity>

        <a-camera id="camera" position="-1 1 0">
                <a-collada-model position="0.5 -1 -0.1" scale="3 3 3" rotation="0 0 110" src="#weapons"></a-collada-model>
                <a-entity shooter click-to-shoot position="-1 -0.4 -1" ></a-entity>
        </a-camera>
    </a-scene>
</body>