<head>
    <title>Code Lyoko VR</title>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="aframe-super-shooter-kit.min.js"></script>
    <script>
        /**
         * Click mouse to shoot.
         */
        AFRAME.registerComponent('click-to-shoot', {
            init: function () {
                document.body.addEventListener('mousedown', () => { this.el.emit('shoot'); });
            }
        });
        /**
         * Change color when hit.
         */
        AFRAME.registerComponent('hit-handler', {
            dependencies: ['material'],
            init: function () {
                var color;
                var el = this.el;
                color = new THREE.Color();
                color.set('#666');
                el.components.material.material.color.copy(color);
                el.addEventListener('hit', () => {
                    //el.components.material.material.color.copy(color);
                    //put song here
                });
                el.addEventListener('die', () => {
                    el.parentNode.removeChild(el);
                });
            }
        });
        //AFRAME.registerComponent('listener', {
        //    tick: function () {
        //      console.log(this.el.getAttribute('position'));
        //    }
        //  });
    </script>
</head>

<body>
    <a-scene>
        
        <a-assets>
            <a-asset-item id="map" src="assets/model.dae"></a-asset-item>
            <a-asset-item id="tower" src="assets/tower/scene.gltf"></a-asset-item>
            <a-asset-item id="weapons" src="assets/odd/odd.dae"></a-asset-item>
            <a-asset-item id="arrow" src="assets/weapons/model.dae"></a-asset-item>
            <a-asset-item id="manta-obj" src="assets/manta/Manta.obj"></a-asset-item>
            <a-asset-item id="manta-mtl" src="assets/manta/Manta.mtl"></a-asset-item>
            <a-asset-item id="megatank" src="assets/megatank/model.dae"></a-asset-item>
            <a-asset-item id="block" src="assets/block/model.dae"></a-asset-item>
            <a-asset-item id="crabe" src="assets/crabe/model.dae"></a-asset-item>
            <a-asset-item id="ulrich" src="assets/ulrich/model.dae"></a-asset-item>
        </a-assets>

        
        <a-collada-model src="#map"></a-collada-model>

        
        <a-obj-model hit-handler src="#manta-obj" class="target" target="healthPoints: 10" rotation="55 20 0" position="-4 6 -4" mtl="#manta-mtl"></a-obj-model>
        <a-collada-model hit-handler class="target" rotation="0 180 0" target="healthPoints: 15" scale="3 3 3" position="12 1.1 7" src="#megatank"></a-collada-model>
        <a-collada-model hit-handler class="target" rotation="0 180 0" scale="1 1 1" target="healthPoints: 15"  position="-33 0 -25" src="#block"></a-collada-model>
        <a-collada-model hit-handler class="target" target="healthPoints: 15" scale="1 1 1" position="12 0 7" src="#crabe"></a-collada-model>

        <a-gltf-model src="#tower" scale="0.1 0.08 0.1" rotation="0 180 0" position="-40 1 -17.034564105607295"></a-gltf-model>

        
        <a-entity collada-model="#arrow" id="bulletTemplate" bullet scale="0.015 0.015 0.015"  material="color: grey" ></a-entity>
        

        
        <a-camera id="camera" listener position="-1 1.4 0">
                <a-collada-model position="0.5 -1 -0.1" scale="3 3 3" rotation="0 0 110" src="#weapons"></a-collada-model>
                <a-entity shooter click-to-shoot position="-1 -0.4 -1" ></a-entity>
        </a-camera>
    </a-scene>
</body>